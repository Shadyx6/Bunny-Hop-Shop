<%- include('./partials/Header.ejs', {hidden: true}) %>

    <main
        style="padding: var(--spacing-xl) 0; min-height: 80vh; background-color: var(--color-bg-primary); display: flex; align-items: center; justify-content: center;">
        <div class="container" style="max-width: 600px;">

            <div
                style="background: white; padding: 3rem; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-md); text-align: center;">

                <div style="margin-bottom: 2rem;">
                    <script src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs"
                        type="module"></script>
                    <div style="display: flex; justify-content: center;">
                        <dotlottie-player src="https://lottie.host/ba63ec0b-0b2e-4ce4-a5d2-23530049fef2/9RNhr1lhwl.json"
                            background="transparent" speed="1" style="width: 150px; height: 150px;" loop
                            autoplay></dotlottie-player>
                    </div>
                </div>

                <h1 style="font-size: 2rem; margin-bottom: 0.5rem; font-family: var(--font-heading);">Order Confirmed!
                </h1>
                <p style="color: var(--color-text-secondary); margin-bottom: 2rem; font-size: 1.1rem;">
                    Thank you, <span
                        style="font-weight: 600; color: var(--color-text-primary); text-transform: capitalize;">
                        <%= userType==='loggedIn' ? user.username : order.fullName %>
                    </span>!
                </p>

                <div
                    style="background: #f9f9f9; padding: 1.5rem; border-radius: var(--border-radius-md); margin-bottom: 2rem; text-align: left;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; border-bottom: 1px dashed var(--color-border); padding-bottom: 1rem;">
                        <span style="font-weight: 600;">Order ID</span>
                        <span
                            style="font-family: monospace; background: white; padding: 2px 6px; border-radius: 4px; border: 1px solid var(--color-border);">#
                            <%= order._id %></span>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem;">Shipping To</h4>
                        <p style="font-size: 0.9rem; line-height: 1.5; color: var(--color-text-secondary);">
                            <%= order.fullName %>
                                <%= order.lastName %><br>
                                    <%= order.shippingAddress.street %><br>
                                        <%= order.shippingAddress.city %>, <%= order.shippingAddress.state %>
                                                <%= order.shippingAddress.zip %><br>
                                                    <%= order.phoneNumber %>
                        </p>
                    </div>

                    <div class="order-summary-toggle">
                        <button id="toggleSummary"
                            style="width: 100%; text-align: left; background: none; border: none; padding: 0.5rem 0; font-size: 0.9rem; color: var(--color-accent-primary); font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                            <span>Show Order Summary</span>
                            <i class="ri-arrow-down-s-line" id="toggleIcon"></i>
                        </button>
                        <div id="summaryContent"
                            style="display: none; margin-top: 1rem; border-top: 1px solid var(--color-border); padding-top: 1rem;">
                            <ul style="list-style: none; padding: 0;">
                                <% order.items.forEach(item=> { %>
                                    <li
                                        style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.9rem;">
                                        <span>
                                            <%= item.productId.title %> <span
                                                    style="color: var(--color-text-secondary);">x<%= item.quantity %>
                                                        </span>
                                        </span>
                                        <span style="font-weight: 500;">PKR <%= item.productId.price * item.quantity %>
                                                </span>
                                        <!-- Note: using simple calculation, real logic might be different if discounts applied per item -->
                                    </li>
                                    <% }) %>
                            </ul>
                            <div
                                style="display: flex; justify-content: space-between; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--color-border); font-weight: 700;">
                                <span>Total</span>
                                <span>PKR <%= (order.totalPrice + 250).toFixed(2) %></span>
                            </div>
                        </div>
                    </div>

                </div>

                <a href="/" class="btn btn-primary" style="padding: 1rem 3rem;">Continue Shopping</a>

            </div>

        </div>
    </main>

    <%- include('./partials/Footer.ejs') %>

        <script>
            const toggleBtn = document.getElementById('toggleSummary');
            const content = document.getElementById('summaryContent');
            const icon = document.getElementById('toggleIcon');

            toggleBtn.addEventListener('click', () => {
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    icon.className = 'ri-arrow-up-s-line';
                    toggleBtn.querySelector('span').textContent = 'Hide Order Summary';
                } else {
                    content.style.display = 'none';
                    icon.className = 'ri-arrow-down-s-line';
                    toggleBtn.querySelector('span').textContent = 'Show Order Summary';
                }
            });
        </script>