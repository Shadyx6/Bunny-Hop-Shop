<%- include('./partials/Header.ejs', {hidden: true}) %>

    <main style="padding: var(--spacing-xl) 0; min-height: 80vh; background-color: var(--color-bg-primary);">
        <div class="container" style="max-width: 900px;">

            <div style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center;">
                <h1 style="font-size: 2rem;">Your Orders</h1>
                <a href="/" class="btn btn-outline" style="font-size: 0.9rem;">Continue Shopping</a>
            </div>

            <% if (orders.length===0) { %>
                <div
                    style="text-align: center; padding: 4rem; background: white; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-sm);">
                    <i class="ri-shopping-bag-line"
                        style="font-size: 3rem; color: var(--color-text-secondary); margin-bottom: 1rem; display: block;"></i>
                    <h3 style="margin-bottom: 0.5rem;">No orders yet</h3>
                    <p style="color: var(--color-text-secondary); margin-bottom: 1.5rem;">Looks like you haven't made
                        your choice yet.</p>
                    <a href="/" class="btn btn-primary">Start Shopping</a>
                </div>
                <% } else { %>
                    <div style="display: grid; gap: 1.5rem;">
                        <% orders.forEach(order=> { %>
                            <div
                                style="background: white; border-radius: var(--border-radius-md); padding: 1.5rem; box-shadow: var(--shadow-sm);">

                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); padding-bottom: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <span style="font-size: 0.9rem; color: var(--color-text-secondary);">Order
                                            ID</span>
                                        <h3 style="font-size: 1.1rem; font-family: var(--font-body);">#<%=
                                                String(order._id).slice(-8).toUpperCase() %>
                                        </h3>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 0.9rem; color: var(--color-text-secondary);">Total Amount
                                        </div>
                                        <div
                                            style="font-size: 1.1rem; font-weight: 600; color: var(--color-accent-primary);">
                                            PKR <%= order.totalPrice %>
                                        </div>
                                    </div>
                                </div>

                                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
                                    <div>
                                        <h4
                                            style="font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-text-secondary);">
                                            Items</h4>
                                        <ul style="list-style: none; padding: 0; margin-bottom: 1rem;">
                                            <% order.items.forEach(item=> { %>
                                                <li
                                                    style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.8rem;">
                                                    <% if(item.productId) { %>
                                                        <div
                                                            style="width: 50px; height: 50px; background: #f9f9f9; border-radius: 4px; overflow: hidden;">
                                                            <img src="<%= item.productId.mainImage %>"
                                                                style="width: 100%; height: 100%; object-fit: cover;">
                                                        </div>
                                                        <div>
                                                            <a href="/products/<%=item.productId._id%>"
                                                                style="font-weight: 500; display: block;">
                                                                <%= item.productId.title %>
                                                            </a>
                                                            <span
                                                                style="font-size: 0.8rem; color: var(--color-text-secondary);">Qty:
                                                                <%= item.quantity %></span>
                                                        </div>
                                                        <% } else { %>
                                                            <span>Product Unavailable</span>
                                                            <% } %>
                                                </li>
                                                <% }) %>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4
                                            style="font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-text-secondary);">
                                            Status</h4>
                                        <span
                                            style="display: inline-block; padding: 4px 12px; background: #f3f4f6; border-radius: 20px; font-size: 0.85rem; text-transform: capitalize; margin-bottom: 1rem;">
                                            <%= order.status %>
                                        </span>

                                        <h4
                                            style="font-size: 0.9rem; font-weight: 600; margin-bottom: 0.2rem; color: var(--color-text-secondary);">
                                            Date</h4>
                                        <p style="font-size: 0.9rem;">
                                            <%= new Date(order.createdAt).toLocaleDateString() %>
                                        </p>
                                    </div>
                                </div>

                                <div
                                    style="margin-top: 1rem; border-top: 1px solid var(--color-border); padding-top: 1rem; text-align: right;">
                                    <button class="btn btn-outline cancel-btn" data-id="<%= order._id %>"
                                        style="color: #dc2626; border-color: #dc2626; font-size: 0.85rem; padding: 0.4rem 1rem;">
                                        Cancel Order
                                    </button>
                                </div>

                            </div>
                            <% }) %>
                    </div>
                    <% } %>

        </div>
    </main>

    <!-- Cancel Modal -->
    <div id="userCancelModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div
            style="background: white; padding: 2rem; border-radius: var(--border-radius-md); width: 90%; max-width: 400px;">
            <h3 style="margin-bottom: 1rem;">Cancel Order</h3>
            <p style="margin-bottom: 1.5rem; color: var(--color-text-secondary);">Are you sure you want to cancel this
                order?</p>
            <div style="display: flex; justify-content: flex-end; gap: 1rem;">
                <button id="closeUserModal" class="btn btn-outline">No</button>
                <form id="userCancelForm" method="POST">
                    <button type="submit" class="btn btn-primary"
                        style="background: #dc2626; border-color: #dc2626;">Yes, Cancel</button>
                </form>
            </div>
        </div>
    </div>

    <%- include('./partials/Footer.ejs') %>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const modal = document.getElementById('userCancelModal');
                const form = document.getElementById('userCancelForm');
                document.querySelectorAll('.cancel-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        form.action = `/orders/cancel/${btn.dataset.id}`;
                        modal.style.display = 'flex';
                    });
                });
                document.getElementById('closeUserModal').addEventListener('click', () => modal.style.display = 'none');
            });
        </script>

        <style>
            @media(max-width: 768px) {
                .container>div>div:nth-child(2) {
                    grid-template-columns: 1fr !important;
                }
            }
        </style>